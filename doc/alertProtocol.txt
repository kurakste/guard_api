Новая тревога.
1) Пользователь передает объект тревоги (событие в сокете: " appNewAlert"): 
    {
      uid: xxxx // id пользователя в базе данных;
      aid: null // здесь будет id тревоги из базы
      time: null // здесь сервер проставит время (timestamp)
      track: [ {lat: xx, lon: xx}, null] // трэк первая координата - место вызова охраны. 
    }
2) Тревога записывается в базу данных со статусом новая.
3) В тревогу проставляется время создания и id из базы данных.
4) Из базы по id извлекается клиент и добавляется в тревогу для отправки операторам.
5) Тревога отправляется клиенту с aid (alert Id) - клиент записывает себе aid.
6) Сервер оповещает всех операторов что случилась тревога (отправляет объект).


Изменение трека в тревоге: 
1) Пользователь отправляет id тревоги и новую координату. Обновляем трек в тревоге. Отправляем событие оператору. (событие в сокете: "trackUpdate");
// А если оператор в этот момент не доступен???
2) Мы по aid обновляем объект тревоги (массив с координатами) в базе данных. 
3) Отправляем обновленную тревогу операторам. 

//=======
 = Аварийный режим = 
  Должен включаться когда оператор, который взял в обработку тревоги отволлся от сервера:
  Допустим в этот момент тревоги передаются на всех оставшихся операторов как отдельный 
  массив со всем параметрами. Они смогут работать с этими тревогами как со своими. 
  Как только оператор подключается назад - тревогу нужно отдать назад на родного операторам

//====
Изменение статуса тревоги операторами: 

Оператор взял тревогу в обработку:
0,5) сервер пытается забронировать деньги на карте. Если удачно то все остальное.
1) отправляет объект тревоги в котором выставлен uid оператора.  (событие в сокете: "alertInWork")
2) Сервер проставляет время. Меняет статус с "новая" на "на обработке".
3) Сервер обновляет запись в базе данных. 

Оператор отправил группу:
1) отправляет объект тревоги в котором: (событие в сокете:  "gbrSent")
   a) выставлен uid оператора. 
   б) могут быть проставлены комментарии. Нужно передавать и сохранять. 
   г) меняет статус тревоги с "на обработке" на "группа отправлена"
2) сервер  проставляет время
3) сервер обновляет объект в базе данных.


alertStatus: 
0   - new alert;
10  - picked up;
20  - group sent
30  - alert decline
40  - alert closed

Оператор отменил тревогу:
1) отправляет объект тревоги в котором: (событие в сокете: "alertDecline")
   a) выставлен uid оператора. 
   б) Должны быть проставлены комментарии. Нужно передавать и сохранять. 
   г) меняет статус тревоги с "на обработке" на "отменена"
   д) отмена бронирования денег
2) сервер  проставляет время
3) сервер обновляет объект в базе данных.


Оператор закрыл тревогу:
1) Оператор дергает: (событие в сокете: alertClose) передает объект тревоги; 
2) Сервер проставляет время.
2,5) Сервер меняет тип тревоги на "закрыта"
3) Обновляет комментарий.
4) Обновляет запись в базе данных (время закрытия и комментарий)
5) Оповещает клиента и операторов что тревога закрыта. Ее эту тревогу нужно будет удалить у операторов. 
// Наверное нужно оставить окно в которых оператор может посмотреть тревоги которые он обрабатывал за како-то промежуток времени. 

====
На старте сервера и на случай его падения мы открываем все тревоги у которых не 
проставлен статус "отменена" и "закрыта"
Нужно что бы операторам переоткрылись все их события. 
А если есть событие оператор которого еще не подключился?
Операторы будут переподключаться с определенной задержкой. 
а если оператор не сможет подключиться?